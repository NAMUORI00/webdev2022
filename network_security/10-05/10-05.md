## 메시지 인증코드



### HMAC (Hashed MAC)

- SHA-1 과 같은 암호학적 해시함수를 이용한 MAC을 만드는 방법에 대해 관심이 집중
- 기존 해시 알고리즘에 키를 삽입하려는 많은 제안 → HASH가 가장 큰 관심을 받음
    - IP Security 용 필수 MAC
    - TLS(전송계층보안) 프로토콜에서 사용
    - SET(안전한 전자 결제) 같은 프로토콜에서도 사용

- 필요성
    - 빠른 속도
    - 코드 획득 용이
    - 수출 규제 없음
    



### HMAC 구조

<img src="10-05/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2022-10-04_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%258C%25E1%2585%25A5%25E1%2586%25AB_10.15.38.png" alt="스크린샷 2022-10-04 오전 10.15.38.png" style="zoom:50%;" />

- **HMAC(K,M) = H[K' ⊕ opad || H[K' ⊕ ipad || M]]**
    - H : 내장된 해시함수
    - M : HMAC의 입력 메시지
    - Y_i : M의 i번째 블록
    - L : M의 블록 수
    - b : 블록의 비트 수
    - n : 내장된 해시함수에 의해 생성된 해시 코드의 길이
    - K : 비밀키
    - K' : K의 왼쪽에 0을 붙여서 길이가 b비트가 되도록 한 것
    - ipad : 00110110를 b/8번 반복한 2진 수열
    - opad : 01011100를 b/8번 반복한 2진 수열

- HMAC 설계 목표
    - 수정하지 않고 쓸 수 있는 해시 함수를 만든다
    - 모듈화
    - 기능저하 방지
    - 키를 보다 쉽게 다룰수 있어야함
    



## 블록암호기반 MAC

- 블록 암호를 이용하여 MAC을 생성하는 방법
    - 암호-기반 메시지 인증 코드(CMAC)
        - AES, 3DES 로 운용됨
        - 메시지 블록 길이가 블록길이의 정수배
    - 암호 블록 체인 카운터-메시지 인증코드(CCM)
        - AES 암호알고리즘 CTR 운용 모드 이용



## 공개 키 암호 원리

- 공개키 암호의 기본 개념
    - 1976년 Diffle, Hellman에 의 해 최초 제안
    - 수학적 함수에 근거를 바탕으로 작동
    - 서로 다른 두 개의 키를 이용하는 비대칭 방식
    - 기밀성, 키 분배, 인증에서 뛰어난 성능을 보여줌
- 키 분배 문제
- RSA 알고리즘
- Diffle-Hellman 알고리즘
- 디지털 서명



### 공개 키 암호 구조

- 평문
- 암호 알고리즘
- 공개 키와 개인 키
- 암호문
- 복호 알고리즘



### 공개키 암호 시스템 운용

- 암호화/복호화
- 디지털 서명
- 키 교환



### 공개 키 암호 시스템 응용

| 알고리즘 | 암호/복호 | 디지털 서명 | 키 교환 |
| --- | --- | --- | --- |
| RSA | y | y | y |
| diffie-hellman | n | n | y |
| DSS | n | y | n |
| 타원곡선 | y | y | y |



### 공개 키 암호 요건

1. B가 한쌍의 키(공개키, 개인키) 생성이 간단해야함
2. 공개 키와 암호화될 메시지를 알고있는 송신자는 다음 암호문을 쉽게 구할 수 있어야함
3. 수신자 입장에서 수신된 암호문을 자신의 개인 키를 이용해서 원문으로 복호화 하는데 쉬워야함
4. 공개키를 알고있는 공격자가 개인키를 알아내는것이 어려워야함
5. 공개키와 암호문을 알고있는 공격자가 원문을 알아내는것이 불가능해야함



### RSA 알고리즘

- Rcon Rivest, Adi Shamirm Len Aeleman, 1978년
- 암호와 복호화
    - 평문 블록 : M
    - 암호문 블록 : C
    - C = m^c mod n
    - M = C^d mod n = (M^c)^d mod n = M^cd nod n
- 송신자와 수신자 모두 n과 e를 아록 있어야 하고 오직 수신자만이 d 값을 알고 있어야 함
    - 이것이 PU = {e, n}, PR = {d, n}를 같은 공ㄱ키 암호 알고리즘 이다
- RSA 암호 요구조건
    - n 보다 작은 정수 M에 대하여 M^cd = M mod n을 만족하는 값 e,d,n을 구할 수 있어야 한다
    - n보다 작은 모든 정수 M에 대해서 M^c와 C^d를 구하는 것이 비교적 쉬워야함
    - e와 n이 주어졌을 때 d를 구하는 것이 불가능해야 한다

- 보안관점
    - 수학적공격
        - 두개의 소수 곱을 인수분해 하는 방식으로 공격 하는 방식
            - 이를 방지하기 위해 긴 길이의 키를 이용해야함. 현재는 3072비트 추천
    - 타이밍 공격
        - 복호화 알고리즘의 실행 시간에 따라 달라진다. 소요 되는 시간이 드러나지 않게 막아, 키 길이를 추측 하는 공격을 막을 수 있다.
            - ex) 랜덤 지체를 이용
    - 선택 암호문 공격
        - 암호 해독시 필요한 데이터 블록 선택을 하고 진행하는 RSA 알고리즘 특성을 이용
            - 평문에 적절한 패딩을 추가한다