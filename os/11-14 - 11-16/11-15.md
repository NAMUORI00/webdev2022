# 교착 상태



## 교착 상태 (Dead Lock)

- 교착상태의 개요
- 교착상태 필요조건
- 교착상태 해결방법
- 다중 자언과 교착 상태 검출

### 교착 상태의 정의

- 2개 이상의 프로세스가 다른 프로세스의 작업을 기다리며 더이상 일의 진행을 못하는 상태 (무한 대기)
- 아사 상태와 차이점
    - 아사 현상 : 운영체제가 잘못된 정책을 사용하여 특정 프로세스의 작업이 지연되는 문제
    - 교착 상태 : 여러 프로세스가 작업을 진행하다보니 자연적으로 일어나는 문제
        - 운영체제의 문제는 아니다, 아사 현상과 다르게 해결하는게 어렵다

### 자원할당 그래프

![image](image\image.png)

- 프로세스가 어떤 자원을 사용중이고 어떤 자원을 기다리고 있는지를 방향성 있는 그래프로 나타낸 것
- 프로세스는 원, 자원은 사각형으로 표현



### 교착 상태 필요 조건

- 상호 배제 : 한 프로세스가 사용하는 자원은 다른 프로세스와 공유 할 수 없는 자원이여야 함
- 비선점 : 한 프로세스가 사용 중인 자원은 중간에 다른 프로세스가 가져갈 수 없어야함
- 점유와 대기 : 프로세스가 어떤 자원을 할당받은 상태에서 다른 자원을 기다리는 상태여야 함
- 원형 대기 : 점유와 대기를 하는 프로세스 간의 과녜가 원을 이루어야 함

- 식사하는 철학자 문제
    - 왼쪽에 있는 포크를 잡은뒤 오른쪽에 있는 포크를 잡아야만 식사가 가능
    
    → 자원을 공유하지 못하면 교착상태가 됨
    
    → 자원을 뺏을 수 없으면 내려놓을 때 까지 기다려야하므로 교착 상태가 됨
    
    → 자원 하나를 집은 상태에서 다른 자원을 기다리면 교착 상태가 발생
    
    → 자원을 요구하는 방향이 원형을 이루면 영보를 하지 못하므로 교착 상태가 발생한다
    
- 만일 사각형 테이블 구조인경우
    - 교착상태는 발생하지 않지만, 한쪽 끝에서 부터 철학자가 식사를 끝마치고 다음으로 넘어가는 걸 기다리는 아사 현상이 있을 수 있음
    
- 교착상태 해결 방법
  
  
    | 해결방법 | 특징 |
    | --- | --- |
    | 교착 상태 예방 | 교착 상태를 유발하는 네 가지 조건을 무력화한다 |
    | 교착 상태 회피 | 교착 상태가 발생하지 않는 수준으로 자원을 할당한다 |
    | 교착 상태 검출 | 자원 할당 그래프를 사용하여 교착 상태를 발견한다 |
    | 교착 상태 회복 | 교착 상태를 검출한 후 해결한다 |
    - 예방, 회피, 검출이 대표적이고 발견후에 회복하는 방법이 있다.
    - 교착 상태 **예방**
        - 교착 상태를 유발하는 네 가지 조건이 발생하지 않도록 무력화하는 방식
    - 교착 상태 **회피**
        - 자원 할당량을 조절하여 교착 상태를 해결하는 방식
    - 교착 상태 **검출과 회복**
        - 교착 상태 검출은 어떤 제약을 가하지 않고 자원 할당 그래프를 모니ㅓ링하면서 교착 상태가 발생하는지 살펴보는 방식, 발생한경우 교착 상태 회복 단계를 실시
    



### 상호 배제 예방

- 독점적으로 사용할 수 있는 자원을 없애는 방법
- 시스템 내의 모든 자원을 공유하는 방식
- 현실적으로 불가능한 방법



### 비선점 예방

- 모든 자원을 빼앗는 방법
- 마찬가지로 임계구역의 잠금 기능을 사용하면 사용할 수 없고, 상호 배제를 보장할 수 없기 때문에 불가능한 방법



### 점유와 대기 예방

- 프로세스가 자원을 점유한 상태에서 다른 자원을 기다리지 못하게 하는 방법
- 선착순 점유순으로 작동하되, 대기하지 않는 구조
- 당장 사용하지 않는 미래의 자원도 미리 선점하여 작동하는 방식

- **단점**
    - 프로세스가 자신이 사용하는 모든 단점을 자세히 알기 어려움
    - 자원의 활용성이 떨어짐
    - 많은 자원을 사용하는 프로세스가 적은 프로세스보다 불리함
    - 결과적으로 일괄 작업으로 동작
    



### 원형 대기 예방

- 점유와 대기를 하는 프로세스들이 원형을 이루지 못하도록 하는 방식
- 모든 자원에 숫자를 부여하고, 숫자가 큰 방향으로만 자원을 할당 하는 것
- 단점
    - 프로세스 작업 진행에 유연성이 떨어짐 
    → (마우스1, 하드2, 프린터 3 일때) → 마우스 사용후 프린터는 가능하지만 그 반대는 불가능
    - 자원의 번호를 부여하는데 판단이 어려움

### 교착 상태 회피의 개념

- 프로세스에 자원을 할당할 때 어느 수준 이상의 자원을 나누어 주면 교착 상태가 발생하는지 파악하여 그 수준 이하로 자원을 나누는 방법
- 교착상태가 발생하지 않는 범위에서만 자원을 할당하고 그외에 경우엔 대기를 시키는 방법

<img src="image\스크린샷_2022-04-18_오후_4.25.29.png" alt="스크린샷_2022-04-18_오후_4.25.29" style="zoom:50%;" />

- 안정 상태와 불안정 상태
    - 할당된 자원수와 자원의 총수를 기준으로 안정 상태, 불안정 상태를 결정하고 안정상태를 유지하도록 자원을 할당
    - 할당 자원이 작을수록 안정 상태가 크고, 늘어날수록 불안정 상태가 커짐
    - 교착상태는 불안정상태의 일부분이며 불안저 상태가 커질수록 교착상태가 발생할 확률이 큼
    



### 은행원 알고리즘(bank algorithm)

- 교착 상태를 회피하는 대표적 알고리즘
- 은행이 대출 해주는 방식, 즉 대출 가능한 범위 내이면 허용되지만 그렇지 않으면 거부되는 것과 비슷한 방식

- 변수
  
  
    | 변수 | 설명 |
    | --- | --- |
    | 전체 자원(Total) | 시스템 내 전체 자원 수 |
    | 가용 자원(Available) | 시스템 내 현재 사용할 수 있는 자원의 수(= 전체자원 - 모든 프로세스 할당 자원) |
    | 촤대 저원(Max) | 각 프로세스가 선언한 최대 자원의 수 |
    | 할당 자원(Alloctation) | 각 프로세스에 현재 할당된 자원의 수 |
    | 기대 자원(Expect) | 각 프로세스가 앞으로 사용할 자원의 수(= 최대자원 - 할당자원) |
- 할당 기준
    - 각 프로세스의 기대 자원가 비교하여 **가용 자원이 하나라도 크거나** 같으면 자원을 할당
    - 가용 자원이 어던 기대 자원보다 크지 않으면 할당 안함
      
        <img src="image\스크린샷_2022-04-18_오후_4.37.13.png" alt="스크린샷_2022-04-18_오후_4.37.13" style="zoom:33%;" />
    
    <img src="image\스크린샷_2022-04-18_오후_4.37.31.png" alt="스크린샷_2022-04-18_오후_4.37.31" style="zoom:33%;" />

<aside>
💡 안전상태 : 각 프로세스의 기대자원과 비교하여 가용 자원이 크거나 같은 경우가 한 번 이상인 경우



- 교착 상태 회피의 문제점
    - 프로세스가 자신이 사용할 모든 자원을 미리 선언해야 함
    - 시스템 전체 자원 수가 고정적여이여 함
    - 자원이 낭비됨
    
