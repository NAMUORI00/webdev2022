# 챕터4 스레드



### 스레드의 개념

- 스레드의 정의
    - CPU 스케줄러가 CPU에 전달하는 일 하나
    - CPU가 처리하는 작업의 단위는 프로세스로부터 전달받은 스레드
        - 운영체제 입장에서의 작업 단위는 프로세스
        - CPU 입장에서의 작업 단위는 스레드

<aside>
💡 스레드 : 프로세스의 코드에 정의된 절차에 따라 CPU에 작업을 요청하는 실행 단위이다.
→ 작업의 크기에 비교하면 내림차순 처리(job) → 프로세스(process) > 테스크(task(s)) → 스레드(thread) 순서가 된다

- taks(s) : 작업의 최소단위 * process / thread
- **Multi-tasking Scheduling**
    - Multi-programing
    - Time-sharing
    - Real-time
- 선점형(Preemtive), 비선점형(non-preemtive)



### 스레드와 프로세스, 멀티태스킹의 차이

- 프로세스와 스레드의 차이
    - 프로세스는 약하게 연결되어 있는 반명 스레드끼리는 강하게 연결되어 있음

- 멀티테스크와 멀티스레드의 차이
    - 멀티테스크 : 여러 개의 프로세스로 구성된 것
    - 멀트스레드 : 하나의 프로세스에 여러 개의 스레드로 구성된것
        - ex) 멀티테스크 : 한글 프로그램 ↔ 스풀러
               멀티스레드 : 한글 프로그램(문서편집, 문서 입출력, 사진, 맞춤법 검사, 그림)

### 멀티 스레드, 멀티테스킹, 멀티 프로세싱

- 멀티스레드
    - 프로세스 내 작업을 여러개의 스레드로 분할함으로써 작업의 부담을 줄이는 프로세스 운영 기법
- 멀티테스킹
    - 운영체제가 CPU에 작업을 줄 때 시간을 잘게 나누어 배분하는 기법
- 멀티프로세싱
    - CPU를 여러 개 사용하여 여러개의 스레드를 동시에 처리하는 작업 환경
    



### CPU 멀티스레드

- 한번에 하나씩 처리해야하는 스레드를 **파이프라인** 기법을 이용하여 동시에 여러 스레드를 처리하도록 만든 병렬 처리 기법을 사용
    - 멀티 스레드 : 운영체제가 소프트웨어적으로 프로세스를 작은 단위의 스레드를 분할하여 운영하는 기법
    - CPU 멀티 스레드 : 하드웨어적인 방법으로 하나의 CPU에서 여러 스레드를 동시에 처리하는 병렬처리 기법



### 멀티스레드 구조와 예

- fork() 시스템 호출로 프로세스를 복사하면 코드 영역, 데이터영역의 일부가 메모리에 중복되어 존재하며, 부모-자식 관계이지만 독립적인 프로세스 이므로 이러한 낭비 요소를 제거 할 수 없다.

- 멀티테스킹과 멀티스레드의 차이
    - fork() 시스템 호출로 여러 개의 프로세스를 생성하면 필요없는 정적 영역이 여러 개가 됨
    - 이를 해결하기 위해 멀티스레드는 코드, 파일 등의 자원을 공유함으로 자원의 낭비를 막고 효율성을 향상시킴
    
    → 이런 의미에서 프로세스에 스레드가 하나이면 무거운 프로세스, 여러개이면 가벼운 프로세스라 부룬다
    
- 멀티스레드의 장점
    - 응답성 향상
    - 자원 공유 → 효율성 향상
    - 다중 CPU 지원

- 멀티스레드의 단점
    - 모든 스레드가 자원을 공유하기 때문에 한 스레드에 문제가 생기면 전체 프로세스에 영향을 미침
    - 예) 인터넷 익스플로러에서 여러개의 화면을 동시에 띄웠는데 그중 하나가 문제가 생기면 인터넷 익스플로러가 종료



### 멀티스레드 모델

- 커널 스레드와, 사용자 스레드
    - 커널 스레드 : 커널이 직접 생성하고 관리하는 스레드
    - 사용자 스레드 : 라이브러리에 의해 구현된 일반적인 스레드
    
- 사용자 레벨 스레드(1 to N)
    - 커널 스레드가 입출력 대기상태에 있으면, 사용자 레벨 스레드도 대기상태가 된다.
    - 커널입장에선 하나의 스레드로 보인다

- 커널 레벨 스레드(1 to 1 )
    - 커널 레벨에서 지원하기 때문에 멀티 CPU를 사용 가능
    - 하나의 스레드가 대기 상태에 있어도 다른 스레드는 작업을 계속할 수 있음
    - 커널 기능을 사용함로 보안에 강하고 안정적으로 작동

- 멀티레벨 스레드(M to N )
    - 사용자 레벨과 커널레벨을 혼합한 방식
    - 커널 스레드가 사용자 스레드보다 수가 적기 때문에 커널 스레드의 개수가 사용자 스레드보다 같거나 적다



### 프로세스의 동적 할당 영역

![스크린샷_2022-03-28_오후_4.42.49](10-31\스크린샷_2022-03-28_오후_4.42.49.png)

- 정적 할당 영역
    - 코드영역 : 프로그램의 본체가 있는곳
    - 데이터영역 : 프로그램이 사용하려고 만든 변수, 파일이 있는 곳
- 동적 할당 영역
    - 스택영역, 힙영역 : 프로세스가 실행되는 동안 만들어지는 영역으로 늘었다가 줄어들기도함
    



### exit(), wait() 함수 호출

- exit() 시스템 호출
    - 작업의 종료를 알려주는 시스템 호출
    - exit() 함수를 선언함으로써 부모 프로세스는 자식 프로세스가 사용하던 자원을 거둬갈 수 있음
    - exit() 함수는 전달 인자를 확인하여 자식 프로세스가 어떤  상태로 종료되었는지 알려줄수있음, 0 정상, -1 비정상 종료

- wait() 시스템 호출
    - 자식 프로세스가 끝나기를 기다렸다가 자식 프로세스가 종료되면 다음 문장을 실행하는 시스템 호출
    - 부모 프로세스와 자식 프로세스간 동기화에도 사용

<aside>
💡 sleep 100 : 전면 프로세스, sleep 100& : 후면 프로세스
전면은 100초 동안 아무런 작업도 못하지만 후면 프로세스는 작동하고 100초뒤에 sleep 100이 끝났음을 알려준다

